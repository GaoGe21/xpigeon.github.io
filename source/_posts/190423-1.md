---
title: study / Redux简单讲解
date: 2019-04-23 22:49:51
tags: study
---

-------------------


我在一篇文章中看到过这样一句话：

>"如果你不知道是否需要使用Redux，那就是不需要。"

在何时需要使用Redux，我的理解是：在需要将一些组件的状态共享以便在任何地方都可以使用时，单纯的使用React已经不能解决问题了，这时就需要用到Redux。

-------------------

在Redux中有以下几个重要的基本概念：

- **state**

上面说Redux就是为了帮React存组件的状态，state其实就是组件的一部分状态。为什么说是一部分呢？因为对于一个组件来说，它有一些状态是永远不会发生改变的，例如id，这一部分状态被称为props。有一些状态是会在交互或者发请求等等的过程中发生改变的，例如：一个panel的打开与关闭，一个radio的勾选与取消，一个下拉框选中值的切换...这些会改变的状态被存为state。

Redux中明确规定，一个state对应一个view，state相同，view就相同。state改变，view的界面就会跟着改变。我们要如何改变state，就有了接下来的action。

- **action**

action顾名思义就是个动作，它也是携带着当前的state以及自身的type类型的一个对象。你应该有见过这样类似的动画场景：在蚂蚁部落，蚁后的一声令下，兵蚁举着刀剑外出征战保卫蚁群，工蚁手持锅碗瓢盆负责整个蚁群的起居... 蚁后就是用户view，兵蚁工蚁就是各个action，大家在蚂蚁窝等待命令。

- **store**

store 就是蚂蚁窝。工蚁将找到的食物搬回蚂蚁窝，就是action运送着state到store的过程，store中存放了各式各样的state...用户点击界面时，store会调用一个方法：store.dispatch()， 用来派发相应的action，相当于蚁后发号命令让兵蚁出征，此时根据相应的type找到了对应的兵蚁，向兵蚁传达了命令。

- **action creator**

因为在蚁群中有成千上万的蚂蚁，蚁后不能一只一只的通知，所以需要一个军师，向下分发命令...action creator就是类似的军师，是一个用来生成所有action的函数。

- **reducer**

命令发出去后，所有兵蚁准备就绪...此时需要为兵蚁分配全新的刀剑即全新的state，这一过程即为reducer。reducer函数接收action以及旧的state，返回一个全新的state，写法如下：

``` python
const reducer = (state = defaultState, state) => {
	// ...
	return new state;
}
//defaultState 为初始状态，默认值
```

此后，兵蚁携带着新的刀剑出征，打下一片新天地。

因为state发生了改变，所以view也进行了对应的更新，完成了页面的刷新。


- **UI组件和容器组件**

UI组件： 单纯用来展示界面，没有任何状态的组件
容器组件： 用来管理状态、处理数据逻辑的组件

**connect**：将UI组件和容器组件关联在一起。
``` python
const UserContainer = 
connect(
  mapStateToProps, mapDispatchToProps
)(User)
```
**mapStateToProps**：将容器组件接收的新state映射成UI组件所对应的props，进而传递给子组件的方法。
``` python
const mapStateToProps: IMapStateToProps<IUserProps> =
    ({ user }) => ({ 
	    ...user,
    });
```
**mapDispatchToProps**：将用户派发的action进行映射，bindActionCreators将 多个action 和 dispatch 组合起来生成mapDispatchToProps 需要生成的内容。
``` python
const mapDispatchToProps: IMapDispatchToProps =
    (dispatch) => {
        return bindActionCreators({
            ...UserActionCreator,
        }, dispatch);
    };
```

-------------------

